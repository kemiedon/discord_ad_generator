# Discord å»£å‘Šç”Ÿæˆå™¨ - 100% å¾©åˆ»æŒ‡å—

æœ¬æ–‡ä»¶æä¾›å®Œæ•´çš„æ­¥é©Ÿï¼Œè®“æ‚¨èƒ½å¤  100% å¾©åˆ»æ­¤å°ˆæ¡ˆã€‚

---

## ç›®éŒ„

1. [å°ˆæ¡ˆçµæ§‹](#å°ˆæ¡ˆçµæ§‹)
2. [ç’°å¢ƒæº–å‚™](#ç’°å¢ƒæº–å‚™)
3. [å°ˆæ¡ˆåˆå§‹åŒ–](#å°ˆæ¡ˆåˆå§‹åŒ–)
4. [ä¾è³´å®‰è£](#ä¾è³´å®‰è£)
5. [æ ¸å¿ƒæ–‡ä»¶å‰µå»º](#æ ¸å¿ƒæ–‡ä»¶å‰µå»º)
6. [çµ„ä»¶å¯¦ä½œ](#çµ„ä»¶å¯¦ä½œ)
7. [æœå‹™å¯¦ä½œ](#æœå‹™å¯¦ä½œ)
8. [æ¨£å¼å¯¦ä½œ](#æ¨£å¼å¯¦ä½œ)
9. [ç’°å¢ƒè®Šæ•¸é…ç½®](#ç’°å¢ƒè®Šæ•¸é…ç½®)
10. [æ¸¬è©¦èˆ‡é‹è¡Œ](#æ¸¬è©¦èˆ‡é‹è¡Œ)
11. [éƒ¨ç½²](#éƒ¨ç½²)

---

## å°ˆæ¡ˆçµæ§‹

```
discord_ad_generator/
â”œâ”€â”€ public/                      # éœæ…‹è³‡æº
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/              # React çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/              # é€šç”¨çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Card/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Card.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Card.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â”œâ”€â”€ FileUpload/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileUpload.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileUpload.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Input/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Loading/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Loading.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Loading.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â”œâ”€â”€ Select/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Select.jsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Select.scss
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”‚   â””â”€â”€ TextArea/
â”‚   â”‚   â”‚       â”œâ”€â”€ TextArea.jsx
â”‚   â”‚   â”‚       â”œâ”€â”€ TextArea.scss
â”‚   â”‚   â”‚       â””â”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ HomePage/
â”‚   â”‚   â”‚   â”œâ”€â”€ HomePage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ HomePage.scss
â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ InputForm/
â”‚   â”‚   â”‚   â”œâ”€â”€ InputForm.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ InputForm.scss
â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ PreviewGrid/
â”‚   â”‚   â”‚   â”œâ”€â”€ PreviewGrid.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PreviewGrid.scss
â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â””â”€â”€ PublishPreview/
â”‚   â”‚       â”œâ”€â”€ PublishPreview.jsx
â”‚   â”‚       â”œâ”€â”€ PublishPreview.scss
â”‚   â”‚       â””â”€â”€ index.js
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ firebase.js           # Firebase é…ç½®
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ discordService.js     # Discord Webhook æœå‹™
â”‚   â”‚   â”œâ”€â”€ firebaseStorage.js    # Firebase Storage æœå‹™
â”‚   â”‚   â””â”€â”€ nanoBananaService.js  # Gemini API æœå‹™
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ _mixins.scss          # SASS mixins
â”‚   â”‚   â”œâ”€â”€ _variables.scss       # SASS è®Šæ•¸
â”‚   â”‚   â””â”€â”€ global.scss           # å…¨åŸŸæ¨£å¼
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ promptBuilder.js      # Prompt æ§‹å»ºå·¥å…·
â”‚   â”œâ”€â”€ App.jsx                   # ä¸»æ‡‰ç”¨çµ„ä»¶
â”‚   â”œâ”€â”€ App.scss                  # ä¸»æ‡‰ç”¨æ¨£å¼
â”‚   â””â”€â”€ main.jsx                  # æ‡‰ç”¨å…¥å£
â”œâ”€â”€ SPEC/                         # å°ˆæ¡ˆè¦æ ¼æ–‡ä»¶
â”‚   â”œâ”€â”€ MAIN.md
â”‚   â”œâ”€â”€ REPLICATION_GUIDE.md      # æœ¬æ–‡ä»¶
â”‚   â””â”€â”€ TESTING_DISCORD.md
â”œâ”€â”€ .env                          # ç’°å¢ƒè®Šæ•¸ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â”œâ”€â”€ .env.example                  # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ index.html                    # HTML å…¥å£
â”œâ”€â”€ package.json                  # å°ˆæ¡ˆé…ç½®
â”œâ”€â”€ README.md                     # å°ˆæ¡ˆèªªæ˜
â””â”€â”€ vite.config.js                # Vite é…ç½®
```

---

## ç’°å¢ƒæº–å‚™

### å¿…è¦å·¥å…·

1. **Node.js** (v18 æˆ–æ›´é«˜)
   ```bash
   node --version  # ç¢ºèªç‰ˆæœ¬
   ```

2. **npm** æˆ– **yarn**
   ```bash
   npm --version
   ```

3. **Git**
   ```bash
   git --version
   ```

4. **ç¨‹å¼ç¢¼ç·¨è¼¯å™¨**ï¼ˆæ¨è–¦ VS Codeï¼‰

### å¿…è¦å¸³è™Ÿ

1. **Google AI Studio**
   - å‰å¾€ï¼šhttps://aistudio.google.com/
   - å»ºç«‹å°ˆæ¡ˆä¸¦å–å¾— API Key

2. **Firebase**
   - å‰å¾€ï¼šhttps://console.firebase.google.com/
   - å»ºç«‹æ–°å°ˆæ¡ˆ
   - å•Ÿç”¨ Storage å’Œ Firestore

3. **Discord**
   - æº–å‚™ä¸€å€‹ Discord ä¼ºæœå™¨
   - å»ºç«‹ Webhookï¼ˆåƒè€ƒ TESTING_DISCORD.mdï¼‰

---

## å°ˆæ¡ˆåˆå§‹åŒ–

### æ­¥é©Ÿ 1ï¼šå»ºç«‹ Vite + React å°ˆæ¡ˆ

```bash
# å»ºç«‹å°ˆæ¡ˆ
npm create vite@latest discord_ad_generator -- --template react

# é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd discord_ad_generator
```

### æ­¥é©Ÿ 2ï¼šåˆå§‹åŒ– Git

```bash
git init
git add .
git commit -m "Initial commit"
```

---

## ä¾è³´å®‰è£

### æ­¥é©Ÿ 1ï¼šå®‰è£ä¸»è¦ä¾è³´

```bash
npm install
```

### æ­¥é©Ÿ 2ï¼šå®‰è£é¡å¤–ä¾è³´

```bash
# HTTP å®¢æˆ¶ç«¯
npm install axios

# Firebase
npm install firebase

# æ¨£å¼
npm install sass

# UI å¢å¼·
npm install react-hot-toast

# jQueryï¼ˆåƒ…ç”¨æ–¼ Datepickerï¼‰
npm install jquery jquery-ui
```

### æ­¥é©Ÿ 3ï¼šç¢ºèª package.json

```json
{
  "name": "discord_ad_generator",
  "private": true,
  "version": "3.5.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.7.9",
    "firebase": "^11.0.2",
    "jquery": "^3.7.1",
    "jquery-ui": "^1.14.1",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-hot-toast": "^2.6.0",
    "sass": "^1.83.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.17.0",
    "@types/react": "^18.3.18",
    "@types/react-dom": "^18.3.5",
    "@vitejs/plugin-react": "^4.3.4",
    "eslint": "^9.17.0",
    "eslint-plugin-react": "^7.37.2",
    "eslint-plugin-react-hooks": "^5.0.0",
    "eslint-plugin-react-refresh": "^0.4.16",
    "globals": "^15.13.0",
    "vite": "^6.0.5"
  }
}
```

---

## æ ¸å¿ƒæ–‡ä»¶å‰µå»º

### 1. Vite é…ç½® (vite.config.js)

```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    host: true
  }
})
```

### 2. HTML å…¥å£ (index.html)

```html
<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Discord å»£å‘Šç”Ÿæˆå™¨</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
```

### 3. æ‡‰ç”¨å…¥å£ (src/main.jsx)

```javascript
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './styles/global.scss'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
```

### 4. ä¸»æ‡‰ç”¨çµ„ä»¶ (src/App.jsx)

```javascript
import { Toaster } from 'react-hot-toast'
import HomePage from './components/HomePage'
import './App.scss'

function App() {
  return (
    <div className="app">
      <header className="app__header">
        <h1 className="app__title">Discord å»£å‘Šç”Ÿæˆå™¨</h1>
        <p className="app__subtitle">Skill Hub - å­¸ç¿’æ®¿å ‚</p>
      </header>
      <main className="app__main">
        <HomePage />
      </main>
      <Toaster
        position="top-right"
        toastOptions={{
          duration: 4000,
          style: {
            background: '#1e1e2e',
            color: '#fff',
          },
          success: {
            iconTheme: {
              primary: '#10b981',
              secondary: '#fff',
            },
          },
          error: {
            iconTheme: {
              primary: '#ef4444',
              secondary: '#fff',
            },
          },
        }}
      />
    </div>
  )
}

export default App
```

### 5. Git å¿½ç•¥æ–‡ä»¶ (.gitignore)

```
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Environment variables
.env
.env.local
.env.*.local

# Test files
test-*.js
test-*.mjs
*.png
*.jpg
*.jpeg
generated-*.jpg
discord-ad-*.png
```

---

## çµ„ä»¶å¯¦ä½œ

ç”±æ–¼çµ„ä»¶è¼ƒå¤šï¼Œé€™è£¡æä¾›é—œéµçµ„ä»¶çš„å¯¦ä½œè¦é»ã€‚å®Œæ•´ç¨‹å¼ç¢¼è«‹åƒè€ƒå°ˆæ¡ˆåŸå§‹ç¢¼ã€‚

### é—œéµé» 1ï¼šHomePage çµ„ä»¶

**åŠŸèƒ½**ï¼š
- ç®¡ç†åœ–ç‰‡ç”Ÿæˆå’Œç™¼å¸ƒæµç¨‹
- æ•´åˆ InputFormã€PreviewGridã€PublishPreview

**é—œéµç‹€æ…‹**ï¼š
```javascript
const [generatedImages, setGeneratedImages] = useState([])
const [isGenerating, setIsGenerating] = useState(false)
const [isPublishing, setIsPublishing] = useState(false)
const [currentFormData, setCurrentFormData] = useState(null)
const [showPreview, setShowPreview] = useState(false)
const [previewImages, setPreviewImages] = useState([])
const previewGridRef = useRef(null)
```

**é—œéµå‡½æ•¸**ï¼š
- `handleGenerate()` - è™•ç†åœ–ç‰‡ç”Ÿæˆ
- `handlePublish()` - æ‰“é–‹é è¦½ Modal
- `handleConfirmPublish()` - ç¢ºèªç™¼å¸ƒåˆ° Discord

### é—œéµé» 2ï¼šInputForm çµ„ä»¶

**åŠŸèƒ½**ï¼š
- æ”¶é›†ä½¿ç”¨è€…è¼¸å…¥ï¼ˆä¸»é¡Œã€æ—¥æœŸã€é‡é»ã€é¢¨æ ¼ã€åƒè€ƒåœ–ç‰‡ï¼‰
- è¡¨å–®é©—è­‰
- æ•´åˆ jQuery UI Datepicker

**jQuery UI Datepicker æ•´åˆ**ï¼š
```javascript
import { useEffect, useRef } from 'react'
import $ from 'jquery'
import 'jquery-ui/ui/widgets/datepicker'
import 'jquery-ui/themes/base/datepicker.css'

useEffect(() => {
  if (dateInputRef.current) {
    $(dateInputRef.current).datepicker({
      dateFormat: 'yy-mm-dd',
      onSelect: (dateText) => {
        handleChange('date', dateText)
      }
    })
  }

  return () => {
    if (dateInputRef.current) {
      $(dateInputRef.current).datepicker('destroy')
    }
  }
}, [])
```

**ç’°å¢ƒè®Šæ•¸è‡ªå‹•è¼‰å…¥**ï¼š
```javascript
const [formData, setFormData] = useState({
  topic: '',
  date: '',
  points: '',
  style: '',
  referenceImage: null,
  webhookUrl: import.meta.env.VITE_DISCORD_WEBHOOK_URL || ''
})
```

### é—œéµé» 3ï¼šPreviewGrid çµ„ä»¶

**åŠŸèƒ½**ï¼š
- é¡¯ç¤ºç”Ÿæˆçš„åœ–ç‰‡
- æ”¯æ´å¤šé¸
- æä¾›ä¸‹è¼‰å’Œç™¼å¸ƒæŒ‰éˆ•

**ä½¿ç”¨ forwardRef æš´éœ²æ–¹æ³•**ï¼š
```javascript
import { forwardRef, useImperativeHandle } from 'react'

const PreviewGrid = forwardRef(({ images, onPublish, isPublishing }, ref) => {
  const [selectedImages, setSelectedImages] = useState([])

  useImperativeHandle(ref, () => ({
    clearSelection: () => {
      setSelectedImages([])
    }
  }))

  // ... çµ„ä»¶é‚è¼¯
})

PreviewGrid.displayName = 'PreviewGrid'
export default PreviewGrid
```

### é—œéµé» 4ï¼šPublishPreview çµ„ä»¶

**åŠŸèƒ½**ï¼š
- é¡¯ç¤ºè¦ç™¼å¸ƒçš„åœ–ç‰‡é è¦½
- å…è¨±ç·¨è¼¯è¨Šæ¯å…§å®¹
- ç¢ºèªå¾Œç™¼å¸ƒ

**é—œéµé‚è¼¯**ï¼š
```javascript
const [message, setMessage] = useState(() => {
  return buildInitialMessage(formData)
})

const buildInitialMessage = (formData) => {
  const { topic, date, points } = formData
  let message = `@everyone\n\nã€æ´»å‹•é€šçŸ¥ã€‘${topic}\nğŸ“… ${date} æ™šä¸Š9:00-10:00\n`
  
  if (points && Array.isArray(points) && points.length > 0) {
    message += `\nâœ¨ æœ¬æ¬¡é‡é»é …ç›®ï¼š\n`
    points.forEach((point, index) => {
      message += `${index + 1}. ${point}\n`
    })
  }
  
  message += `\nğŸ’¬ æ­¡è¿å¤§å®¶ä¸€èµ·ä¾†è¨è«–ã€äº¤æµç¶“é©—ï¼Œä¸€èµ·é€²æ­¥ï¼`
  return message
}
```

### é—œéµé» 5ï¼šModal çµ„ä»¶

**åŠŸèƒ½**ï¼š
- é€šç”¨å½ˆçª—çµ„ä»¶
- æ”¯æ´ä¸åŒå°ºå¯¸
- é»æ“ŠèƒŒæ™¯é—œé–‰
- é–å®š body æ»¾å‹•

**é—œéµå¯¦ä½œ**ï¼š
```javascript
useEffect(() => {
  if (isOpen) {
    document.body.style.overflow = 'hidden'
  } else {
    document.body.style.overflow = 'unset'
  }
  return () => {
    document.body.style.overflow = 'unset'
  }
}, [isOpen])

const handleBackdropClick = (e) => {
  if (e.target === e.currentTarget) {
    onClose()
  }
}
```

---

## æœå‹™å¯¦ä½œ

### 1. Gemini API æœå‹™ (src/services/nanoBananaService.js)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ä½¿ç”¨ axios ç›´æ¥èª¿ç”¨ Gemini REST API
- æ”¯æ´ text-to-image å’Œ image-to-image
- ç€è¦½å™¨åŸç”Ÿ base64 è½‰æ›

**é—œéµç¨‹å¼ç¢¼**ï¼š

```javascript
import axios from 'axios'

const API_ENDPOINT = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-3-pro-image-preview:generateContent'

export const generateImages = async (prompt, referenceImageUrl = null) => {
  const apiKey = import.meta.env.VITE_NANO_BANANA_API_KEY

  // æ§‹å»ºè«‹æ±‚å…§å®¹
  const parts = [{ text: prompt }]

  // å¦‚æœæœ‰åƒè€ƒåœ–ç‰‡ï¼ŒåŠ å…¥ image-to-image
  if (referenceImageUrl) {
    const imageData = await loadImageAsBase64(referenceImageUrl)
    parts.push({
      inline_data: {
        mime_type: 'image/jpeg',
        data: imageData
      }
    })
  }

  const requestBody = {
    contents: [{
      parts: parts
    }],
    generationConfig: {
      temperature: 1,
      topK: 40,
      topP: 0.95,
      maxOutputTokens: 8192,
      responseMimeType: 'text/plain'
    }
  }

  // ç™¼é€è«‹æ±‚ï¼ˆç”Ÿæˆ 4 å¼µåœ–ç‰‡ï¼‰
  const numberOfImages = 4
  const promises = Array(numberOfImages).fill(null).map(() =>
    axios.post(`${API_ENDPOINT}?key=${apiKey}`, requestBody)
  )

  const responses = await Promise.all(promises)
  return responses.map(response => extractImageFromResponse(response.data))
}

// ç€è¦½å™¨åŸç”Ÿ base64 è½‰æ›
const loadImageAsBase64 = async (imageUrl) => {
  const response = await fetch(imageUrl)
  const blob = await response.blob()
  
  return new Promise((resolve, reject) => {
    const reader = new FileReader()
    reader.onloadend = () => {
      const base64String = reader.result.split(',')[1]
      resolve(base64String)
    }
    reader.onerror = reject
    reader.readAsDataURL(blob)
  })
}

// å¾ Gemini å›æ‡‰ä¸­æå–åœ–ç‰‡
const extractImageFromResponse = (responseData) => {
  const text = responseData.candidates[0].content.parts[0].text
  const base64Match = text.match(/data:image\/(png|jpeg|jpg);base64,([A-Za-z0-9+/=]+)/)
  
  if (base64Match) {
    return `data:image/${base64Match[1]};base64,${base64Match[2]}`
  }
  
  throw new Error('ç„¡æ³•å¾å›æ‡‰ä¸­æå–åœ–ç‰‡')
}
```

### 2. Discord æœå‹™ (src/services/discordService.js)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ä½¿ç”¨ Webhook ç™¼å¸ƒåœ–ç‰‡å’Œè¨Šæ¯
- æ ¼å¼åŒ–è¨Šæ¯å…§å®¹
- URL é©—è­‰

**é—œéµç¨‹å¼ç¢¼**ï¼š

```javascript
import axios from 'axios'

// base64 Data URL è½‰ Blob
const dataUrlToBlob = (dataUrl) => {
  const arr = dataUrl.split(',')
  const mime = arr[0].match(/:(.*?);/)[1]
  const bstr = atob(arr[1])
  let n = bstr.length
  const u8arr = new Uint8Array(n)
  while (n--) {
    u8arr[n] = bstr.charCodeAt(n)
  }
  return new Blob([u8arr], { type: mime })
}

// æ§‹å»º Discord è¨Šæ¯
const buildDiscordMessage = (formData) => {
  const { topic, date, points } = formData
  let message = `@everyone\n\nã€æ´»å‹•é€šçŸ¥ã€‘${topic}\nğŸ“… ${date} æ™šä¸Š9:00-10:00\n`
  
  if (points && Array.isArray(points) && points.length > 0) {
    message += `\nâœ¨ æœ¬æ¬¡é‡é»é …ç›®ï¼š\n`
    points.forEach((point, index) => {
      message += `${index + 1}. ${point}\n`
    })
  }
  
  message += `\nğŸ’¬ æ­¡è¿å¤§å®¶ä¸€èµ·ä¾†è¨è«–ã€äº¤æµç¶“é©—ï¼Œä¸€èµ·é€²æ­¥ï¼`
  return message
}

// ç™¼å¸ƒåˆ° Discord
export const publishToDiscord = async (imageUrls, formData, webhookUrl, customMessage = null) => {
  if (!webhookUrl) {
    throw new Error('è«‹å…ˆè¨­å®š Discord Webhook URL')
  }

  if (!imageUrls || imageUrls.length === 0) {
    throw new Error('æ²’æœ‰é¸æ“‡è¦ç™¼å¸ƒçš„åœ–ç‰‡')
  }

  try {
    const messageContent = customMessage || buildDiscordMessage(formData)
    const formDataToSend = new FormData()
    
    formDataToSend.append('content', messageContent)
    
    imageUrls.forEach((imageUrl, index) => {
      const blob = dataUrlToBlob(imageUrl)
      const fileName = `${formData.topic.replace(/\s+/g, '_')}_${index + 1}.png`
      formDataToSend.append(`file${index}`, blob, fileName)
    })

    const response = await axios.post(webhookUrl, formDataToSend, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })

    return {
      success: true,
      message: 'æˆåŠŸç™¼å¸ƒåˆ° Discordï¼',
      imageCount: imageUrls.length
    }
  } catch (error) {
    throw new Error(`ç™¼å¸ƒå¤±æ•—: ${error.message}`)
  }
}

// é©—è­‰ Webhook URL
export const validateWebhookUrl = (url) => {
  if (!url) return false
  const webhookPattern = /^https:\/\/discord\.com\/api\/webhooks\/\d+\/[\w-]+$/
  return webhookPattern.test(url)
}
```

### 3. Firebase Storage æœå‹™ (src/services/firebaseStorage.js)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ä¸Šå‚³åƒè€ƒåœ–ç‰‡åˆ° Firebase Storage
- å–å¾—åœ–ç‰‡ URL

**é—œéµç¨‹å¼ç¢¼**ï¼š

```javascript
import { storage } from '../config/firebase'
import { ref, uploadBytes, getDownloadURL } from 'firebase/storage'

export const uploadFile = async (file, folder = 'reference_images') => {
  if (!file) {
    throw new Error('æ²’æœ‰é¸æ“‡æª”æ¡ˆ')
  }

  try {
    const timestamp = Date.now()
    const fileName = `${folder}/${timestamp}_${file.name}`
    const storageRef = ref(storage, fileName)

    const snapshot = await uploadBytes(storageRef, file)
    const downloadURL = await getDownloadURL(snapshot.ref)

    return downloadURL
  } catch (error) {
    throw new Error(`ä¸Šå‚³å¤±æ•—: ${error.message}`)
  }
}
```

### 4. Firebase é…ç½® (src/config/firebase.js)

```javascript
import { initializeApp } from 'firebase/app'
import { getStorage } from 'firebase/storage'
import { getFirestore } from 'firebase/firestore'

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID
}

const app = initializeApp(firebaseConfig)
export const storage = getStorage(app)
export const db = getFirestore(app)
```

### 5. Prompt æ§‹å»ºå·¥å…· (src/utils/promptBuilder.js)

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- æ ¹æ“šè¡¨å–®è³‡æ–™æ§‹å»º AI Prompt
- ç¢ºä¿æ–‡å­—å¯è®€æ€§

**é—œéµç¨‹å¼ç¢¼**ï¼š

```javascript
const STYLE_MAP = {
  'cyberpunk': 'cyberpunk',
  '90s-anime': '90s anime style',
  'hand-drawn-japanese': 'hand-drawn Japanese illustration',
  'watercolor': 'watercolor painting',
  'photorealistic': 'photorealistic',
  'retro-poster': 'retro poster design',
  'neon': 'neon style'
}

export const buildPrompt = (formData) => {
  const { topic, date, points, style } = formData
  const selectedStyle = STYLE_MAP[style] || 'modern design'

  let keyPointsSection = ''
  if (points && points.length > 0) {
    const pointsList = points.map((p, i) => `${i + 1}. ${p}`).join('\n')
    keyPointsSection = `
Key Points:
${pointsList}`
  }

  return `Create a Discord event promotional image in ${selectedStyle} style.

Content Requirements:
- Main Title: "${topic}" (bold, sans-serif font, adjust size if text is long, no line breaks)
- Brand: "Skill Hub"
- Subtitle: "Kemie, Ayn, è–åšè€å¸«ã®å­¸ç¿’æ®¿å ‚"
- Event Time: "${date} æ™šä¸Š9:00-10:00" (clear and prominent)${keyPointsSection}

CRITICAL - Text Readability:
- Background MUST include blurred areas or gradient color blocks for text placement
- If background is complex, add a semi-transparent rectangular overlay:
  * Use white overlay (rgba(255,255,255,0.8)) for dark backgrounds
  * Use black overlay (rgba(0,0,0,0.7)) for light backgrounds
- Text color must contrast well with background (white on dark, black on light)
- Ensure all text is clearly readable

Image Specifications:
- Size: 1080x1080px
- Format: Square, suitable for Discord and social media
- Style: ${selectedStyle}`
}
```

---

## æ¨£å¼å¯¦ä½œ

### 1. å…¨åŸŸè®Šæ•¸ (src/styles/_variables.scss)

```scss
// é¡è‰²ç³»çµ±
$primary-color: #5865F2;
$secondary-color: #00D9FF;
$accent-color: #FF006E;
$success-color: #10b981;
$error-color: #ef4444;
$warning-color: #f59e0b;

// èƒŒæ™¯é¡è‰²
$bg-primary: #0f0f1e;
$bg-secondary: #1a1a2e;
$card-bg: #16213e;

// æ–‡å­—é¡è‰²
$text-primary: #ffffff;
$text-secondary: #a0aec0;
$text-muted: #718096;

// é–“è·
$spacing-xs: 4px;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;
$spacing-xl: 32px;
$spacing-2xl: 48px;

// é‚Šæ¡†åŠå¾‘
$radius-sm: 4px;
$radius-md: 8px;
$radius-lg: 12px;
$radius-xl: 16px;

// é™°å½±
$shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
$shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
$shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
$shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);

// å‹•ç•«æ™‚é–“
$transition-fast: 0.15s;
$transition-base: 0.2s;
$transition-slow: 0.3s;

// æ–·é»
$breakpoint-sm: 640px;
$breakpoint-md: 768px;
$breakpoint-lg: 1024px;
$breakpoint-xl: 1280px;
```

### 2. Mixins (src/styles/_mixins.scss)

```scss
// éŸ¿æ‡‰å¼æ–·é»
@mixin mobile {
  @media (max-width: #{$breakpoint-md - 1px}) {
    @content;
  }
}

@mixin tablet {
  @media (min-width: #{$breakpoint-md}) and (max-width: #{$breakpoint-lg - 1px}) {
    @content;
  }
}

@mixin desktop {
  @media (min-width: #{$breakpoint-lg}) {
    @content;
  }
}

// Flexbox
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

// æ–‡å­—çœç•¥
@mixin text-ellipsis {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

// å¡ç‰‡æ¨£å¼
@mixin card {
  background: $card-bg;
  border-radius: $radius-lg;
  padding: $spacing-lg;
  box-shadow: $shadow-md;
}

// æŒ‰éˆ•é‡ç½®
@mixin button-reset {
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  font: inherit;
  cursor: pointer;
  outline: none;
}
```

### 3. å…¨åŸŸæ¨£å¼ (src/styles/global.scss)

```scss
@import './variables';
@import './mixins';

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  background: $bg-primary;
  color: $text-primary;
  overflow-x: hidden;
}

#root {
  min-height: 100vh;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}

// æ»¾å‹•æ¢æ¨£å¼
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: $bg-secondary;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 5px;

  &:hover {
    background: rgba(255, 255, 255, 0.3);
  }
}
```

---

## ç’°å¢ƒè®Šæ•¸é…ç½®

### 1. å‰µå»º .env æ–‡ä»¶

```bash
touch .env
```

### 2. å¡«å…¥ç’°å¢ƒè®Šæ•¸

```env
# Gemini API (nano-banana pro)
VITE_NANO_BANANA_API_KEY=ä½ çš„_Gemini_API_Key

# Firebase é…ç½®
VITE_FIREBASE_API_KEY=ä½ çš„_Firebase_API_Key
VITE_FIREBASE_AUTH_DOMAIN=ä½ çš„å°ˆæ¡ˆID.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=ä½ çš„å°ˆæ¡ˆID
VITE_FIREBASE_STORAGE_BUCKET=ä½ çš„å°ˆæ¡ˆID.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=ä½ çš„_Sender_ID
VITE_FIREBASE_APP_ID=ä½ çš„_App_ID

# Discord Webhook URLï¼ˆé¸å¡«ï¼‰
VITE_DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/ä½ çš„webhook_id/ä½ çš„webhook_token
```

### 3. å»ºç«‹ .env.exampleï¼ˆçµ¦å…¶ä»–é–‹ç™¼è€…åƒè€ƒï¼‰

```env
# Gemini API (nano-banana pro)
VITE_NANO_BANANA_API_KEY=your_api_key_here

# Firebase é…ç½®
VITE_FIREBASE_API_KEY=your_firebase_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_project_id.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_project_id.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id

# Discord Webhook URLï¼ˆé¸å¡«ï¼‰
VITE_DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/your_webhook_id/your_webhook_token
```

---

## æ¸¬è©¦èˆ‡é‹è¡Œ

### æ­¥é©Ÿ 1ï¼šå•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
npm run dev
```

æ‡‰è©²æœƒçœ‹åˆ°ï¼š
```
  VITE v6.0.5  ready in XXX ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
```

### æ­¥é©Ÿ 2ï¼šæ¸¬è©¦åœ–ç‰‡ç”Ÿæˆ

1. é–‹å•Ÿç€è¦½å™¨è¨ªå• http://localhost:5173
2. å¡«å¯«è¡¨å–®ï¼š
   - æ´»å‹•ä¸»é¡Œï¼šã€ŒAI å·¥ä½œåŠã€
   - æ´»å‹•æ—¥æœŸï¼šé¸æ“‡æ—¥æœŸ
   - é‡é»é …ç›®ï¼šå¡«å…¥å¹¾å€‹é‡é»ï¼ˆé¸å¡«ï¼‰
   - åœ–ç‰‡é¢¨æ ¼ï¼šé¸æ“‡ä¸€ç¨®é¢¨æ ¼
   - åƒè€ƒåœ–ç‰‡ï¼šå¯é¸æ“‡ä¸Šå‚³ï¼ˆé¸å¡«ï¼‰
3. é»æ“Šã€Œç”Ÿæˆåœ–ç‰‡ã€
4. ç­‰å¾… 30-60 ç§’
5. æ‡‰è©²æœƒçœ‹åˆ° 4 å¼µç”Ÿæˆçš„åœ–ç‰‡

### æ­¥é©Ÿ 3ï¼šæ¸¬è©¦ Discord ç™¼å¸ƒ

1. ç¢ºèª `.env` ä¸­æœ‰è¨­å®š `VITE_DISCORD_WEBHOOK_URL`
2. æˆ–åœ¨è¡¨å–®ä¸­æ‰‹å‹•è¼¸å…¥ Webhook URL
3. é¸æ“‡è¦ç™¼å¸ƒçš„åœ–ç‰‡ï¼ˆé»æ“Šåœ–ç‰‡å·¦ä¸Šè§’çš„æ ¸å–æ–¹å¡Šï¼‰
4. é»æ“Šã€Œç™¼å¸ƒåˆ° Discordã€
5. åœ¨é è¦½å½ˆçª—ä¸­ç¢ºèªåœ–ç‰‡å’Œè¨Šæ¯
6. ç·¨è¼¯è¨Šæ¯ï¼ˆå¦‚éœ€è¦ï¼‰
7. é»æ“Šã€Œç¢ºèªç™¼å¸ƒåˆ° Discordã€
8. æª¢æŸ¥ Discord é »é“æ˜¯å¦æ”¶åˆ°è¨Šæ¯å’Œåœ–ç‰‡

### å¸¸è¦‹å•é¡Œæ’é™¤

**å•é¡Œ 1ï¼šåœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼ˆ403 éŒ¯èª¤ï¼‰**
- æª¢æŸ¥ Gemini API Key æ˜¯å¦æœ‰æ•ˆ
- ç¢ºèª API Key æœ‰åœ–ç‰‡ç”Ÿæˆæ¬Šé™
- æª¢æŸ¥ API é…é¡æ˜¯å¦ç”¨ç›¡

**å•é¡Œ 2ï¼šDiscord ç™¼å¸ƒå¤±æ•—ï¼ˆ404 éŒ¯èª¤ï¼‰**
- æª¢æŸ¥ Webhook URL æ ¼å¼æ˜¯å¦æ­£ç¢º
- ç¢ºèª Webhook æ²’æœ‰è¢«åˆªé™¤
- é‡æ–°å»ºç«‹ Webhook ä¸¦æ›´æ–° URL

**å•é¡Œ 3ï¼šåƒè€ƒåœ–ç‰‡ä¸Šå‚³å¤±æ•—**
- æª¢æŸ¥ Firebase Storage è¦å‰‡
- ç¢ºèª Firebase å°ˆæ¡ˆå·²å•Ÿç”¨ Storage
- æª¢æŸ¥åœ–ç‰‡å¤§å°ï¼ˆå»ºè­° < 5 MBï¼‰

**å•é¡Œ 4ï¼šDatepicker ä¸é¡¯ç¤º**
- ç¢ºèª jQuery å’Œ jQuery UI å·²å®‰è£
- æª¢æŸ¥ CSS æ˜¯å¦æ­£ç¢ºå¼•å…¥
- æŸ¥çœ‹ç€è¦½å™¨ Console æ˜¯å¦æœ‰éŒ¯èª¤

---

## éƒ¨ç½²

### é¸é … 1ï¼šéƒ¨ç½²åˆ° Vercel

```bash
# å®‰è£ Vercel CLI
npm i -g vercel

# ç™»å…¥
vercel login

# éƒ¨ç½²
vercel
```

### é¸é … 2ï¼šéƒ¨ç½²åˆ° Firebase Hosting

```bash
# å®‰è£ Firebase CLI
npm install -g firebase-tools

# ç™»å…¥
firebase login

# åˆå§‹åŒ–
firebase init hosting

# å»ºç½®å°ˆæ¡ˆ
npm run build

# éƒ¨ç½²
firebase deploy --only hosting
```

### éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

- [ ] æ‰€æœ‰ç’°å¢ƒè®Šæ•¸å·²è¨­å®š
- [ ] Firebase å°ˆæ¡ˆå·²å»ºç«‹ä¸¦é…ç½®
- [ ] Discord Webhook å·²å»ºç«‹
- [ ] .env æ–‡ä»¶æœªæäº¤åˆ° Git
- [ ] å°ˆæ¡ˆå·²é€šéæœ¬åœ°æ¸¬è©¦
- [ ] åœ–ç‰‡ç”ŸæˆåŠŸèƒ½æ­£å¸¸
- [ ] Discord ç™¼å¸ƒåŠŸèƒ½æ­£å¸¸

---

## ç‰ˆæœ¬æ§åˆ¶å»ºè­°

### Git Commit æ ¼å¼

```bash
# åŠŸèƒ½æ–°å¢
git commit -m "feat: æ–°å¢ Discord ç™¼å¸ƒé è¦½åŠŸèƒ½"

# Bug ä¿®å¾©
git commit -m "fix: ä¿®å¾©ç€è¦½å™¨ç›¸å®¹æ€§å•é¡Œ"

# æ¨£å¼èª¿æ•´
git commit -m "style: å„ªåŒ– Modal å‹•ç•«æ•ˆæœ"

# æ–‡æª”æ›´æ–°
git commit -m "docs: æ›´æ–° README å®‰è£èªªæ˜"

# é‡æ§‹
git commit -m "refactor: é‡æ§‹ discordService ç¨‹å¼ç¢¼çµæ§‹"

# æ¸¬è©¦
git commit -m "test: æ–°å¢åœ–ç‰‡ç”Ÿæˆæ¸¬è©¦"
```

### ç‰ˆæœ¬è™Ÿè¦å‰‡

ä½¿ç”¨èªç¾©åŒ–ç‰ˆæœ¬è™Ÿï¼ˆSemantic Versioningï¼‰ï¼š

- **ä¸»ç‰ˆæœ¬è™Ÿï¼ˆMajorï¼‰**ï¼šä¸ç›¸å®¹çš„ API ä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬è™Ÿï¼ˆMinorï¼‰**ï¼šå‘ä¸‹ç›¸å®¹çš„åŠŸèƒ½æ–°å¢
- **ä¿®è¨‚è™Ÿï¼ˆPatchï¼‰**ï¼šå‘ä¸‹ç›¸å®¹çš„å•é¡Œä¿®æ­£

ç¯„ä¾‹ï¼š
- `1.0.0` - åˆå§‹ç‰ˆæœ¬
- `1.1.0` - æ–°å¢åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼šç™¼å¸ƒé è¦½ï¼‰
- `1.1.1` - Bug ä¿®å¾©

---

## ç¸½çµ

éµå¾ªæœ¬æŒ‡å—ï¼Œæ‚¨æ‡‰è©²èƒ½å¤  100% å¾©åˆ»æ­¤å°ˆæ¡ˆã€‚é—œéµè¦é»ï¼š

1. **ç’°å¢ƒæº–å‚™**ï¼šç¢ºä¿æ‰€æœ‰å¿…è¦å·¥å…·å’Œå¸³è™Ÿå·²å°±ç·’
2. **ä¾è³´å®‰è£**ï¼šåš´æ ¼æŒ‰ç…§ package.json å®‰è£ä¾è³´
3. **çµ„ä»¶å¯¦ä½œ**ï¼šæŒ‰ç…§å°ˆæ¡ˆçµæ§‹é€æ­¥å»ºç«‹çµ„ä»¶
4. **æœå‹™æ•´åˆ**ï¼šæ­£ç¢ºé…ç½® Gemini APIã€Firebaseã€Discord
5. **æ¸¬è©¦é©—è­‰**ï¼šæ¯å€‹åŠŸèƒ½éƒ½è¦æ¸¬è©¦ç¢ºä¿æ­£å¸¸é‹ä½œ
6. **ç’°å¢ƒè®Šæ•¸**ï¼šæ­£ç¢ºè¨­å®šæ‰€æœ‰ç’°å¢ƒè®Šæ•¸

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹åƒè€ƒï¼š
- `SPEC/MAIN.md` - å®Œæ•´è¦æ ¼æ›¸
- `TESTING_DISCORD.md` - Discord æ¸¬è©¦æŒ‡å—
- åŸå§‹ç¢¼æ³¨é‡‹ - æ¯å€‹æ–‡ä»¶éƒ½æœ‰è©³ç´°èªªæ˜

ç¥æ‚¨å¾©åˆ»æˆåŠŸï¼ğŸ‰
