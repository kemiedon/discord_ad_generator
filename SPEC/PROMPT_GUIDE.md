# AI 指令規範書

## 核心規範

### 1. 語言規定

**所有與使用者的對話必須使用繁體中文（Traditional Chinese）**

- 所有回應、說明、註解都必須使用繁體中文
- 代碼註解也應使用繁體中文
- 文檔和規格書必須使用繁體中文撰寫

### 2. 版本控制與提交規範

**每當完成一個任務後，必須自動執行 git commit 和 push 到 repository**

#### Commit 訊息格式：

- 格式：`(Y-m-d H:i:s)-版本號`
- 版本號規則：
  - 從 1.0 開始
  - 每次提交遞增 0.1（例如：1.0 → 1.1 → 1.2）
  - 格式範例：
    - `(2025-11-24 23:16:32)-1.0`
    - `(2025-11-24 23:20:15)-1.1`
    - `(2025-11-24 23:25:40)-1.2`

#### 自動化流程：

1. 完成任務後自動執行 `git add .`
2. 使用指定格式建立 commit
3. 自動執行 `git push` 推送到遠端倉庫
4. **重要**：每次更新程式碼後，自動執行 push 到 repository，無需詢問使用者同意
5. 版本號根據上次提交自動遞增 0.1
6. **自動預覽**：每次完成一個功能後，自動使用 VS Code 內建的 Simple Browser 開啟 live server（通常是 http://localhost:3000）進行預覽與測試

### 3. 開發流程規範

**在使用者確認規格前，不得直接產生程式碼或相關文件**

- 收到開發需求後，先與使用者確認完整規格
- 提供開發計畫或架構建議，等待使用者確認
- 只有在使用者明確確認後，才開始撰寫程式碼
- 如有疑問或不明確的需求，必須先詢問使用者

### 4. 技術棧規範

**必須明確使用使用者指定的技術棧（Tech Stacks）進行開發**

- 嚴格遵守使用者指定的框架、函式庫和工具
- 不得擅自更換或添加未經許可的技術
- 如需使用額外的技術或套件，必須先徵得使用者同意
- 確保所有依賴項目符合指定的版本要求

### 5. 專案特定指令重點（Discord 廣告生成器）

#### 🛠️ 技術整合規範

- **React + jQuery UI 混用**：
  - 核心框架使用 React.js + Vite
  - 日期選擇器 **必須** 使用 `jQuery UI Datepicker`
  - 使用 `useEffect` 進行 jQuery 插件的初始化與銷毀
  - 其他 UI 組件優先使用 React 原生實作

#### 🎨 UX 設計規範

- **表單設計**：
  - 採用單欄佈局（Single Column）以降低認知負擔
  - 實作即時驗證（Inline Validation），錯誤訊息需清晰明確
  - 採用漸進式揭露（Progressive Disclosure），非必要欄位預設隱藏或標示為可選
- **響應式佈局**：
  - 桌面版：左右分欄（左表單、右預覽）
  - 手機版：上下堆疊（上表單、下預覽）

#### 🖼️ 圖片生成規範（文字可讀性優先）

- **背景處理**：
  - 生成圖片必須包含 **模糊區域** 或 **漸層色塊**，作為文字放置區
  - 若背景過於複雜，**自動疊加半透明矩形遮罩**
    - 深色背景 → 白色半透明遮罩
    - 淺色背景 → 黑色半透明遮罩
- **Prompt 要求**：
  - 在構建 AI Prompt 時，必須明確包含上述背景處理指令
  - 確保文字與背景有足夠對比度

---

## 使用者 Prompt 記錄（2025-12-03）

本節記錄使用者在 2025-12-03 提出的所有需求和指令，按時間順序排列：

### 1. UI 排版改進 - 歷史記錄彈出視窗

**原始 Prompt:**

> 目前的 ui 排版似乎有些問題，我希望在右上角有個按鈕，叫做歷史記錄，打開時顯示彈出視窗與我的生成歷史

**需求分析:**

- 將歷史記錄從底部面板改為彈出視窗 (Modal)
- 在右上角添加固定按鈕
- 點擊按鈕打開彈出視窗顯示歷史
- 支援背景點擊關閉

**實作結果:**

- 創建 Modal 式歷史記錄面板
- 添加右上角固定按鈕
- 實作淡入淡出和滑動動畫
- 載入歷史後自動關閉視窗

---

### 2. SCSS 編譯錯誤修復

**錯誤訊息:**

> Undefined variable $primary

**需求分析:**

- SCSS 變數 $primary 不存在
- 需改用 $discord-purple
- 其他缺失變數: $border-color, $bg-secondary

**實作結果:**

- 將所有 $primary 改為 $discord-purple
- 添加 $border-color: #3F4147
- 添加 $bg-secondary: #313338
- 修正所有 SCSS 編譯錯誤

---

### 3. Firebase 測試與超時問題

**原始 Prompt:**

> 測試時會一直卡在保存歷史記錄

**問題分析:**

- Firestore API 未啟用導致 permission-denied
- 圖片 base64 太大 (>1MB) 超過 Firestore 單文檔限制
- 保存操作無超時機制

**實作結果:**

- 創建 test-firebase.html 測試工具
- 添加 15 秒超時機制
- 實作縮圖生成 (50KB, 300px)
- 只保存縮圖而非完整圖片

---

### 4. Firebase 設定確認

**原始 Prompt:**

> 我啟用 firebase 資料庫後，是否要自己手動建立集合

**回答:**

- Firestore 會在首次寫入時自動創建集合
- 無需手動建立
- 確保 Firestore API 已啟用並等待 2-5 分鐘生效

---

### 5. Discord 預設訊息修改

**原始 Prompt:**

> 請將 discord 預設訊息改為「💬 歡迎大家一起來討論、交流 AI 開發經驗，一起共同成長！」

**實作結果:**

- 更新 discordService.js 中的預設訊息
- 同時更新 fallback 訊息和常規訊息
- 更符合 AI 開發社群氛圍

---

### 6. 表單 UI 優化與 Webhook 管理

**原始 Prompt:**

> 我希望表單的 input 顏色不要跟背景一樣深，另外當使用者修改 Discord Webhook URL 我想要有一個下拉選單，可以讓我設定我要發布到哪一個頻道

**需求分析:**

- 表單輸入框背景色太深，難以辨識
- 需要 Webhook 預設選項下拉選單
- 支援多個頻道快速切換
- 保留自訂 URL 選項

**實作結果:**

- 創建 webhooks.js 配置檔管理多個頻道
- 添加 Webhook 下拉選單 (2 個預設頻道 + 自訂選項)
- Input/TextArea/Select 背景色改為較淺的 $bg-secondary
- 添加明顯邊框 ($border-color)
- Focus 時背景色和邊框顏色變化
- 選擇「自訂 Webhook URL」時才顯示輸入框

---

### 7. 語法錯誤修復

**錯誤訊息:**

> SyntaxError: Unexpected identifier 'webhook'

**問題分析:**

- WEBHOOKS 陣列尾部有多餘逗號
- 某些 JavaScript 環境不允許尾部逗號

**實作結果:**

- 移除陣列最後一個元素後的逗號
- 修正語法錯誤

---

### 8. 圖片生成進度條

**原始 Prompt:**

> 對了，生成圖片的時候是否能有進度條讓使用者比較理解目前生成進度到哪

**需求分析:**

- 圖片生成需要 30-60 秒，使用者不清楚進度
- 需要視覺化顯示當前生成狀態
- 顯示具體第幾張圖片正在生成

**實作結果:**

- 創建 ProgressBar 組件
- 顯示當前張數/總張數 (如 2/4)
- 顯示百分比進度
- 顯示詳細狀態訊息:
  - 準備開始生成...
  - 正在處理參考圖片...
  - 正在構建生成提示詞...
  - 正在生成第 N 張圖片...
  - ✅ 第 N 張圖片生成成功
  - 正在壓縮圖片...
  - ✅ 生成完成！
  - 正在保存歷史記錄...
  - ✅ 已保存到歷史記錄
- nanoBananaService 添加 onProgress 回調
- 漸層紫色進度條配合主題
- 動態光澤效果 (shimmer animation)
- 狀態文字脈衝動畫 (pulse animation)

---

### 9. dataUrl 未定義錯誤

**錯誤訊息:**

> Undefined label 'dataUrl' (at nanoBananaService.js:105:23)

**問題分析:**

- 代碼合併錯誤導致在定義 dataUrl 前使用
- 缺少 imageData 和 mimeType 的提取邏輯
- 有重複的代碼行

**實作結果:**

- 確保先從 API 回應提取 imageData 和 mimeType
- 然後構建 dataUrl
- 最後才使用 dataUrl
- 移除重複代碼
- 保留進度回調功能

---

### 10. 文檔更新請求

**原始 Prompt:**

> 請將今天的調整與修改總結並更新到 main.md, 另外將我的 prompt 整理更新到 prompt_guide.md，總結完成後請依照復刻需求更新 replication_guide

**需求分析:**

- 更新 MAIN.md 添加 v4.2.0 版本記錄
- 更新 PROMPT_GUIDE.md 記錄所有使用者 prompt
- 創建 REPLICATION_GUIDE.md 提供完整復刻指南

**實作目標:**

- 完整記錄今天所有功能改進
- 記錄所有使用者需求和實作結果
- 提供詳細的環境設定和部署指南

---

## 提示詞框架指南

### 3. 圖片生成工具開發提示詞框架

#### 📋 基本結構

```
【任務目標】
- 明確說明要生成的圖片類型和用途
- 指定圖片的應用場景

【設計需求】
1. 風格定義：
   - 視覺風格（例如：現代、復古、極簡、華麗等）
   - 色彩方案（主色調、配色、色彩情緒）
   - 設計語言（扁平、立體、漸層、material design等）

2. 內容元素：
   - 必要元素列表
   - 文字內容（標題、副標題、說明文字）
   - 圖標或符號需求
   - 排版佈局建議

3. 技術規格：
   - 尺寸規格（寬x高，例如：1920x1080）
   - 圖片格式（PNG、JPG、WebP等）
   - 解析度要求（72dpi網頁用或300dpi印刷用）
   - 檔案大小限制（如適用）

【參考範例】
- 提供靈感來源或參考圖片
- 說明喜歡的設計特點
- 列出不想要的元素

【輸出要求】
- 圖片數量
- 變化版本需求
- 命名規則
```

---

### 4. Web 開發提示詞框架

#### 📋 基本結構

```
【專案概述】
- 專案名稱和目的
- 目標用戶群
- 核心功能說明

【技術需求】
1. 前端技術棧：
   - 框架選擇（HTML/CSS/JS、React、Vue、Next.js等）
   - UI庫或框架（Bootstrap、Tailwind、Material-UI等）
   - 是否需要響應式設計

2. 功能需求：
   - 核心功能列表（優先級排序）
   - 互動行為說明
   - 數據流和狀態管理

3. 設計要求：
   - 視覺風格指南
   - 色彩方案
   - 排版和佈局偏好
   - 動畫和過渡效果

【技術約束】
- 瀏覽器支援需求
- 效能要求
- SEO需求
- 無障礙（Accessibility）要求

【開發階段】
1. 初始設置
2. 設計系統建立
3. 組件開發
4. 頁面組裝
5. 測試和優化

【交付物】
- 原始碼結構
- 文檔需求
- 部署說明
```
